<!DOCTYPE html>
<html>
<head>
    <title>内容加载</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
        #contentFrame {
            width: 100%;
            height: 100%;
            border: none;
        }
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <p>页面加载中...</p>
    </div>

    <iframe id="contentFrame" src="about:blank" style="display: none;"></iframe>

    <script>
        // 免费的CORS代理服务
        const proxies = [
            'https://api.allorigins.win/raw?url=',
            'https://corsproxy.io/?',
            'https://proxy.cors.sh/?'
        ];

        function urlSafeBase64Decode(str) {
            let padded = str;
            while (padded.length % 4 !== 0) {
                padded += '=';
            }
            try {
                return atob(padded.replace(/-/g, '+').replace(/_/g, '/'));
            } catch (e) {
                return null;
            }
        }

        function getProxyUrl(targetUrl, proxyIndex = 0) {
            if (proxyIndex >= proxies.length) return null;
            return proxies[proxyIndex] + encodeURIComponent(targetUrl);
        }

        function loadWithProxy(targetUrl, proxyIndex = 0) {
            const proxyUrl = getProxyUrl(targetUrl, proxyIndex);
            if (!proxyUrl) {
                document.getElementById('loading').innerHTML = '<p>加载失败，请稍后重试</p>';
                return;
            }

            const frame = document.getElementById('contentFrame');
            frame.src = proxyUrl;

            frame.onload = function() {
                document.getElementById('loading').style.display = 'none';
                frame.style.display = 'block';
            };

            frame.onerror = function() {
                // 尝试下一个代理
                loadWithProxy(targetUrl, proxyIndex + 1);
            };

            // 设置超时，如果5秒内没加载成功，尝试下一个代理
            setTimeout(function() {
                if (frame.style.display === 'none') {
                    loadWithProxy(targetUrl, proxyIndex + 1);
                }
            }, 5000);
        }

        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const encoded = urlParams.get('u');

            if (encoded) {
                const decoded = urlSafeBase64Decode(encoded);
                if (decoded && (decoded.startsWith('http://') || decoded.startsWith('https://'))) {
                    loadWithProxy(decoded);
                    return;
                }
            }

            document.getElementById('loading').innerHTML = '<p>无效的URL参数</p>';
        };
    </script>
</body>
</html>