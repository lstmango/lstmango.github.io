<!DOCTYPE html>
<html>
<head>
    <title>内容加载</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
        #contentFrame {
            width: 100%;
            height: 100%;
            border: none;
        }
        .fallback {
            text-align: center;
            padding: 50px 20px;
        }
    </style>
</head>
<body>
    <div id="fallback" class="fallback" style="display: none;">
        <h2>内容加载失败</h2>
        <p>请点击下方按钮在新窗口中打开</p>
        <a href="#" id="openNew" style="display: inline-block; padding: 10px 20px; background: #07c160; color: white; text-decoration: none; border-radius: 5px;">在新窗口中打开</a>
    </div>

    <iframe id="contentFrame" src="about:blank"></iframe>

    <script>
        function urlSafeBase64Decode(str) {
            let padded = str;
            while (padded.length % 4 !== 0) {
                padded += '=';
            }

            try {
                return atob(padded.replace(/-/g, '+').replace(/_/g, '/'));
            } catch (e) {
                return null;
            }
        }

        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const encoded = urlParams.get('u');
            const frame = document.getElementById('contentFrame');
            const fallback = document.getElementById('fallback');
            const openNew = document.getElementById('openNew');

            if (encoded) {
                const decoded = urlSafeBase64Decode(encoded);
                if (decoded && (decoded.startsWith('http://') || decoded.startsWith('https://'))) {
                    // 尝试在iframe中加载
                    frame.src = decoded;

                    // 如果iframe加载失败，显示备用方案
                    frame.onerror = function() {
                        frame.style.display = 'none';
                        fallback.style.display = 'block';
                        openNew.href = decoded;
                    };

                    // 设置备用方案的链接
                    openNew.href = decoded;
                    return;
                }
            }

            // 如果参数无效
            frame.style.display = 'none';
            fallback.style.display = 'block';
            document.querySelector('#fallback h2').textContent = '无效的链接';
            openNew.style.display = 'none';
        };
    </script>
</body>
</html>